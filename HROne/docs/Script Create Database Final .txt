/* =========================================================CREATE DATABASE SCRIPT â€“ FULL & FINAL========================================================= *//* =========================================================CREATE TABLES========================================================= */CREATE TABLE Ordre(Num_Ordre INT NOT NULL,AAAA INT NOT NULL,MM INT NOT NULL,JJ INT NOT NULL, HH INT NOT NULL,MN INT NOT NULL, SS INT NOT NULL,CONSTRAINT PK_Ordre PRIMARY KEY(Num_Ordre) ) ENGINE=InnoDB;CREATE TABLE Type_Action(Code_Type_Action INT NOT NULL AUTO_INCREMENT, Description_Action VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Action PRIMARY KEY(Code_Type_Action) ) ENGINE=InnoDB; CREATE TABLE Type_Reaction(Code_Type_Reaction INT NOT NULL AUTO_INCREMENT, Description_Reaction VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Reaction PRIMARY KEY(Code_Type_Reaction) ) ENGINE=InnoDB;CREATE TABLE Type_Langue(Code_Type_Langue INT NOT NULL AUTO_INCREMENT, Description_Langue VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Langue PRIMARY KEY(Code_Type_Langue) ) ENGINE=InnoDB; CREATE TABLE Type_Contrat(Code_Type_Contrat INT NOT NULL AUTO_INCREMENT, Description_Contrat VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Contrat PRIMARY KEY(Code_Type_Contrat) ) ENGINE=InnoDB;CREATE TABLE Type_Competence(Code_Type_Competence INT NOT NULL AUTO_INCREMENT, Description_Competence VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Competence PRIMARY KEY(Code_Type_Competence) ) ENGINE=InnoDB; CREATE TABLE Type_Niveau_Etude(Code_Type_Niveau_Etude INT NOT NULL AUTO_INCREMENT, Description_Type_Etude VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Niveau_Etude PRIMARY KEY(Code_Type_Niveau_Etude) ) ENGINE=InnoDB;CREATE TABLE Type_Background_Etude(Code_Type_Background_Etude INT NOT NULL AUTO_INCREMENT, Description_Type_Background_Etude VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Background_Etude PRIMARY KEY(Code_Type_Background_Etude)) ENGINE=InnoDB;CREATE TABLE Type_Status_Condidature(Code_Type_Status_Condidature INT NOT NULL AUTO_INCREMENT, Description_Status_Condidature VARCHAR(255) NOT NULL, CONSTRAINT PK_Type_Status_Condidature PRIMARY KEY(Code_Type_Status_Condidature)) ENGINE=InnoDB;CREATE TABLE Entreprise(ID_Entreprise INT NOT NULL AUTO_INCREMENT, Nom_Entreprise VARCHAR(255) NOT NULL, Reference VARCHAR(100), CONSTRAINT PK_Entreprise PRIMARY KEY(ID_Entreprise)) ENGINE=InnoDB;CREATE TABLE Profil(ID_Profil INT NOT NULL AUTO_INCREMENT, Nom_Profil VARCHAR(100) NOT NULL, CONSTRAINT PK_Profil PRIMARY KEY(ID_Profil)) ENGINE=InnoDB;CREATE TABLE UTILISATEUR(ID_UTILISATEUR INT NOT NULL AUTO_INCREMENT, ID_Entreprise INT NOT NULL, ID_Profil INT NOT NULL, Nom_Utilisateur VARCHAR(100) NOT NULL, Mot_Passe VARCHAR(255) NOT NULL, Email VARCHAR(255), Adresse VARCHAR(255), Num_Tel VARCHAR(30), CIN VARCHAR(20), Num_Ordre_Sign_In INT NOT NULL, Date_Naissance DATE, Gender CHAR(1), CONSTRAINT PK_UTILISATEUR PRIMARY KEY(ID_UTILISATEUR), CONSTRAINT FK_UTILISATEUR_Entreprise FOREIGN KEY(ID_Entreprise) REFERENCES Entreprise(ID_Entreprise), CONSTRAINT FK_UTILISATEUR_Profil FOREIGN KEY(ID_Profil) REFERENCES Profil(ID_Profil), CONSTRAINT FK_UTILISATEUR_Ordre FOREIGN KEY(Num_Ordre_Sign_In) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Employee(ID_Employe INT NOT NULL AUTO_INCREMENT, ID_UTILISATEUR INT NOT NULL, Solde_Conge INT NOT NULL, Nbr_Heure_De_Travail INT NOT NULL, Mac_Machine VARCHAR(50), CONSTRAINT PK_Employee PRIMARY KEY(ID_Employe), CONSTRAINT FK_Employee_UTILISATEUR FOREIGN KEY(ID_UTILISATEUR) REFERENCES UTILISATEUR(ID_UTILISATEUR)) ENGINE=InnoDB;CREATE TABLE Outils_De_Travail(ID_Outil INT NOT NULL AUTO_INCREMENT, Identifiant_Universelle VARCHAR(255) NOT NULL, Hash_App VARCHAR(255) NOT NULL, CONSTRAINT PK_Outils_De_Travail PRIMARY KEY(ID_Outil)) ENGINE=InnoDB;CREATE TABLE Performance(ID_Outil INT NOT NULL, ID_Employe INT NOT NULL, ID_Session INT NOT NULL, Seconde_Active INT NOT NULL, CONSTRAINT PK_Performance PRIMARY KEY(ID_Outil, ID_Employe, ID_Session), CONSTRAINT FK_Performance_Outil FOREIGN KEY(ID_Outil) REFERENCES Outils_De_Travail(ID_Outil), CONSTRAINT FK_Performance_Employee FOREIGN KEY(ID_Employe) REFERENCES Employee(ID_Employe)) ENGINE=InnoDB;CREATE TABLE Demande_Conge(ID_Demende INT NOT NULL AUTO_INCREMENT,ID_Employe INT NOT NULL,Nbr_Jour_Demande INT NOT NULL,Num_Ordre_Debut_Conge INT NOT NULL,Num_Ordre_Fin_Conge INT NOT NULL,Status INT NOT NULL,CONSTRAINT PK_Demande_Conge PRIMARY KEY(ID_Demende),CONSTRAINT FK_DemandeConge_Employee FOREIGN KEY(ID_Employe) REFERENCES Employee(ID_Employe),CONSTRAINT FK_DemandeConge_Ordre_Debut FOREIGN KEY(Num_Ordre_Debut_Conge) REFERENCES Ordre(Num_Ordre), CONSTRAINT FK_DemandeConge_Ordre_Fin FOREIGN KEY(Num_Ordre_Fin_Conge) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Condidat(ID_Condidat INT NOT NULL AUTO_INCREMENT,ID_UTILISATEUR INT NOT NULL,CV TEXT,CONSTRAINT PK_Condidat PRIMARY KEY(ID_Condidat),CONSTRAINT FK_Condidat_UTILISATEUR FOREIGN KEY(ID_UTILISATEUR) REFERENCES UTILISATEUR(ID_UTILISATEUR)) ENGINE=InnoDB;CREATE TABLE Offre(ID_Offre INT NOT NULL AUTO_INCREMENT,Titre VARCHAR(255) NOT NULL,Description TEXT,ID_Entreprise INT NOT NULL,Work_Type VARCHAR(100),Code_Type_Contrat INT NOT NULL,Nbr_Annee_Experience INT, Code_Type_Niveau_Etude INT NOT NULL, Min_Salaire INT, Max_Salaire INT, Num_Ordre_Creation INT NOT NULL, Num_Ordre_Expiration INT NOT NULL, CONSTRAINT PK_Offre PRIMARY KEY(ID_Offre), CONSTRAINT FK_Offre_Entreprise FOREIGN KEY(ID_Entreprise) REFERENCES Entreprise(ID_Entreprise), CONSTRAINT FK_Offre_Contrat FOREIGN KEY(Code_Type_Contrat) REFERENCES Type_Contrat(Code_Type_Contrat), CONSTRAINT FK_Offre_Niveau FOREIGN KEY(Code_Type_Niveau_Etude) REFERENCES Type_Niveau_Etude(Code_Type_Niveau_Etude), CONSTRAINT FK_Offre_Ordre_Creation FOREIGN KEY(Num_Ordre_Creation) REFERENCES Ordre(Num_Ordre), CONSTRAINT FK_Offre_Ordre_Expiration FOREIGN KEY(Num_Ordre_Expiration) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Detail_Offre_Competence(ID_Offre INT NOT NULL, Code_Type_Competence INT NOT NULL, CONSTRAINT PK_Detail_Offre_Competence PRIMARY KEY(ID_Offre, Code_Type_Competence), CONSTRAINT FK_DOC_Offre FOREIGN KEY(ID_Offre) REFERENCES Offre(ID_Offre), CONSTRAINT FK_DOC_Competence FOREIGN KEY(Code_Type_Competence) REFERENCES Type_Competence(Code_Type_Competence)) ENGINE=InnoDB;CREATE TABLE Detail_Offre_Langue(ID_Offre INT NOT NULL, Code_Type_Langue INT NOT NULL, CONSTRAINT PK_Detail_Offre_Langue PRIMARY KEY(ID_Offre, Code_Type_Langue), CONSTRAINT FK_DOL_Offre FOREIGN KEY(ID_Offre) REFERENCES Offre(ID_Offre), CONSTRAINT FK_DOL_Langue FOREIGN KEY(Code_Type_Langue) REFERENCES Type_Langue(Code_Type_Langue)) ENGINE=InnoDB;CREATE TABLE Detail_Offre_Background(ID_Offre INT NOT NULL, Code_Type_Background_Etude INT NOT NULL, CONSTRAINT PK_Detail_Offre_Background PRIMARY KEY(ID_Offre, Code_Type_Background_Etude), CONSTRAINT FK_DOB_Offre FOREIGN KEY(ID_Offre) REFERENCES Offre(ID_Offre), CONSTRAINT FK_DOB_Background FOREIGN KEY(Code_Type_Background_Etude) REFERENCES Type_Background_Etude(Code_Type_Background_Etude)) ENGINE=InnoDB;CREATE TABLE Condidature(ID_Condidature INT NOT NULL AUTO_INCREMENT, ID_Condidat INT NOT NULL, Lettre_Motivation TEXT, Portfolio TEXT, Lettre_Recomendation TEXT, Code_Type_Status INT NOT NULL, CONSTRAINT PK_Condidature PRIMARY KEY(ID_Condidature), CONSTRAINT FK_Condidature_Condidat FOREIGN KEY(ID_Condidat) REFERENCES Condidat(ID_Condidat), CONSTRAINT FK_Condidature_Status FOREIGN KEY(Code_Type_Status) REFERENCES Type_Status_Condidature(Code_Type_Status_Condidature)) ENGINE=InnoDB;CREATE TABLE Entretien(ID_Condidat INT NOT NULL, ID_RH INT NOT NULL, Num_Ordre_Entretien INT NOT NULL, Localisation VARCHAR(255), Status_Entretien INT, Evaluation TEXT, CONSTRAINT PK_Entretien PRIMARY KEY(ID_Condidat, ID_RH, Num_Ordre_Entretien), CONSTRAINT FK_Entretien_Condidat FOREIGN KEY(ID_Condidat) REFERENCES Condidat(ID_Condidat), CONSTRAINT FK_Entretien_RH FOREIGN KEY(ID_RH) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_Entretien_Ordre FOREIGN KEY(Num_Ordre_Entretien) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Formation(ID_Formation INT NOT NULL AUTO_INCREMENT, Titre VARCHAR(255) NOT NULL, Description TEXT, Num_Ordre_Creation INT NOT NULL, ID_Entreprise INT NOT NULL, Image VARCHAR(255), CONSTRAINT PK_Formation PRIMARY KEY(ID_Formation), CONSTRAINT FK_Formation_Ordre FOREIGN KEY(Num_Ordre_Creation) REFERENCES Ordre(Num_Ordre), CONSTRAINT FK_Formation_Entreprise FOREIGN KEY(ID_Entreprise) REFERENCES Entreprise(ID_Entreprise)) ENGINE=InnoDB;CREATE TABLE Cours(ID_Cours INT NOT NULL AUTO_INCREMENT, Code_Type_Background_Etude INT NOT NULL, Contenu TEXT NOT NULL, CONSTRAINT PK_Cours PRIMARY KEY(ID_Cours), CONSTRAINT FK_Cours_Background FOREIGN KEY(Code_Type_Background_Etude) REFERENCES Type_Background_Etude(Code_Type_Background_Etude)) ENGINE=InnoDB;CREATE TABLE Detail_Formation(ID_Formation INT NOT NULL, ID_Cours INT NOT NULL, CONSTRAINT PK_Detail_Formation PRIMARY KEY(ID_Formation, ID_Cours), CONSTRAINT FK_DF_Formation FOREIGN KEY(ID_Formation) REFERENCES Formation(ID_Formation), CONSTRAINT FK_DF_Cours FOREIGN KEY(ID_Cours) REFERENCES Cours(ID_Cours)) ENGINE=InnoDB;CREATE TABLE Certification(ID_Certif INT NOT NULL AUTO_INCREMENT, ID_Formation INT NOT NULL, Description_Certif VARCHAR(255), CONSTRAINT PK_Certification PRIMARY KEY(ID_Certif), CONSTRAINT FK_Certification_Formation FOREIGN KEY(ID_Formation) REFERENCES Formation(ID_Formation)) ENGINE=InnoDB;CREATE TABLE Participation_Formation(ID_Formation INT NOT NULL, ID_Participant INT NOT NULL, Num_Ordre_Participation INT NOT NULL, CONSTRAINT PK_Participation_Formation PRIMARY KEY(ID_Formation, ID_Participant), CONSTRAINT FK_PF_Formation FOREIGN KEY(ID_Formation) REFERENCES Formation(ID_Formation), CONSTRAINT FK_PF_UTILISATEUR FOREIGN KEY(ID_Participant) REFERENCES UTILISATEUR(ID_UTILISATEUR)) ENGINE=InnoDB;CREATE TABLE Evenement(ID_Evenement INT NOT NULL AUTO_INCREMENT, Titre VARCHAR(255) NOT NULL, Description TEXT, Num_Ordre_Creation INT NOT NULL, Num_Ordre_Debut_Evenement INT NOT NULL, Num_Ordre_Fin_Evenement INT NOT NULL, Localisation VARCHAR(255), Image VARCHAR(255), CONSTRAINT PK_Evenement PRIMARY KEY(ID_Evenement), CONSTRAINT FK_Evenement_Ordre_Creation FOREIGN KEY(Num_Ordre_Creation) REFERENCES Ordre(Num_Ordre), CONSTRAINT FK_Evenement_Ordre_Debut FOREIGN KEY(Num_Ordre_Debut_Evenement) REFERENCES Ordre(Num_Ordre), CONSTRAINT FK_Evenement_Ordre_Fin FOREIGN KEY(Num_Ordre_Fin_Evenement) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Activite(ID_Activite INT NOT NULL AUTO_INCREMENT, Titre VARCHAR(255) NOT NULL, Description TEXT, CONSTRAINT PK_Activite PRIMARY KEY(ID_Activite)) ENGINE=InnoDB;CREATE TABLE Detail_Evenement(ID_Evenement INT NOT NULL, ID_Activite INT NOT NULL, Num_Ordre_Debut_Activite INT NOT NULL, Num_Ordre_Fin_Activite INT NOT NULL, CONSTRAINT PK_Detail_Evenement PRIMARY KEY (ID_Evenement, ID_Activite, Num_Ordre_Debut_Activite, Num_Ordre_Fin_Activite), CONSTRAINT FK_DE_Evenement FOREIGN KEY(ID_Evenement) REFERENCES Evenement(ID_Evenement), CONSTRAINT FK_DE_Activite FOREIGN KEY(ID_Activite) REFERENCES Activite(ID_Activite), CONSTRAINT FK_DE_Ordre_Debut FOREIGN KEY(Num_Ordre_Debut_Activite) REFERENCES Ordre(Num_Ordre), CONSTRAINT FK_DE_Ordre_Fin FOREIGN KEY(Num_Ordre_Fin_Activite) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Participation_Evenement(ID_Evenement INT NOT NULL, ID_Activite INT NOT NULL, ID_Participant INT NOT NULL, Num_Ordre_Participation INT NOT NULL, CONSTRAINT PK_Participation_Evenement PRIMARY KEY(ID_Evenement, ID_Activite, ID_Participant), CONSTRAINT FK_PE_Evenement FOREIGN KEY(ID_Evenement) REFERENCES Evenement(ID_Evenement), CONSTRAINT FK_PE_Activite FOREIGN KEY(ID_Activite) REFERENCES Activite(ID_Activite), CONSTRAINT FK_PE_UTILISATEUR FOREIGN KEY(ID_Participant) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_PE_Ordre FOREIGN KEY(Num_Ordre_Participation) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Email(ID_Email INT NOT NULL, ID_Receiver INT NOT NULL, ID_Sender INT NOT NULL, Objet VARCHAR(255), Contenue TEXT, Num_Ordre_Envoi INT NOT NULL, Status_Mail INT NOT NULL, CONSTRAINT PK_Email PRIMARY KEY(ID_Email, ID_Receiver, ID_Sender), CONSTRAINT FK_Email_Receiver FOREIGN KEY(ID_Receiver) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_Email_Sender FOREIGN KEY(ID_Sender) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_Email_Ordre FOREIGN KEY(Num_Ordre_Envoi) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Post(ID_Post INT NOT NULL AUTO_INCREMENT, ID_UTILISATEUR INT NOT NULL, Titre VARCHAR(255) NOT NULL, Description TEXT, Image VARCHAR(255), Num_Ordre_Post INT NOT NULL, CONSTRAINT PK_Post PRIMARY KEY(ID_Post), CONSTRAINT FK_Post_UTILISATEUR FOREIGN KEY(ID_UTILISATEUR) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_Post_Ordre FOREIGN KEY(Num_Ordre_Post) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Commentaire(ID_Commentaire INT NOT NULL AUTO_INCREMENT, ID_UTILISATEUR INT NOT NULL, ID_Post INT NOT NULL, Est_Reponse TINYINT(1) NOT NULL, ID_Parent INT, Num_Ordre_Commentaire INT NOT NULL, CONSTRAINT PK_Commentaire PRIMARY KEY(ID_Commentaire), CONSTRAINT FK_Commentaire_UTILISATEUR FOREIGN KEY(ID_UTILISATEUR) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_Commentaire_Post FOREIGN KEY(ID_Post) REFERENCES Post(ID_Post), CONSTRAINT FK_Commentaire_Parent FOREIGN KEY(ID_Parent) REFERENCES Commentaire(ID_Commentaire), CONSTRAINT FK_Commentaire_Ordre FOREIGN KEY(Num_Ordre_Commentaire) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Reaction(ID_Commentaire INT NOT NULL, Code_Type_Reaction INT NOT NULL, ID_UTILISATEUR INT NOT NULL, Num_Ordre_Reaction INT NOT NULL, CONSTRAINT PK_Reaction PRIMARY KEY(ID_Commentaire, Code_Type_Reaction, ID_UTILISATEUR), CONSTRAINT FK_Reaction_Commentaire FOREIGN KEY(ID_Commentaire) REFERENCES Commentaire(ID_Commentaire), CONSTRAINT FK_Reaction_Type FOREIGN KEY(Code_Type_Reaction) REFERENCES Type_Reaction(Code_Type_Reaction), CONSTRAINT FK_Reaction_UTILISATEUR FOREIGN KEY(ID_UTILISATEUR) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_Reaction_Ordre FOREIGN KEY(Num_Ordre_Reaction) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;CREATE TABLE Chat(ID_Chat INT NOT NULL AUTO_INCREMENT, ID_UTILISATEUR1 INT NOT NULL, ID_UTILISATEUR2 INT NOT NULL, CONSTRAINT PK_Chat PRIMARY KEY(ID_Chat), CONSTRAINT FK_Chat_UTILISATEUR1 FOREIGN KEY(ID_UTILISATEUR1) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_Chat_UTILISATEUR2 FOREIGN KEY(ID_UTILISATEUR2) REFERENCES UTILISATEUR(ID_UTILISATEUR)) ENGINE=InnoDB;CREATE TABLE Message(ID_Message INT NOT NULL AUTO_INCREMENT, ID_Chat INT NOT NULL, ID_Sender INT NOT NULL, Contenue TEXT NOT NULL, Status INT NOT NULL, CONSTRAINT PK_Message PRIMARY KEY(ID_Message), CONSTRAINT FK_Message_Chat FOREIGN KEY(ID_Chat) REFERENCES Chat(ID_Chat), CONSTRAINT FK_Message_UTILISATEUR FOREIGN KEY(ID_Sender) REFERENCES UTILISATEUR(ID_UTILISATEUR)) ENGINE=InnoDB;CREATE TABLE Action_utilisateur(ID_UTILISATEUR INT NOT NULL, Code_Type_Action INT NOT NULL, Num_Ordre INT NOT NULL, Commentaire VARCHAR(255), CONSTRAINT PK_Action_UTILISATEUR PRIMARY KEY(ID_UTILISATEUR, Code_Type_Action), CONSTRAINT FK_ActionUTILISATEUR_UTILISATEUR FOREIGN KEY(ID_UTILISATEUR) REFERENCES UTILISATEUR(ID_UTILISATEUR), CONSTRAINT FK_ActionUTILISATEUR_Type FOREIGN KEY(Code_Type_Action) REFERENCES Type_Action(Code_Type_Action), CONSTRAINT FK_ActionUTILISATEUR_Ordre FOREIGN KEY(Num_Ordre) REFERENCES Ordre(Num_Ordre)) ENGINE=InnoDB;/* =========================================================
CREATE PLSQL FUNCTIO HANDLE ORDRE
========================================================= */
DELIMITER $$

CREATE OR REPLACE PROCEDURE Ensure_NumOrdre_Exists (IN p_NumOrdre INT) BEGIN DECLARE v_exists INT;DECLARE v_datetime DATETIME;DECLARE v_pivot DATETIME DEFAULT '2020-01-01 00:00:00';IF p_NumOrdre IS NOT NULL AND p_NumOrdre > 0 THEN SELECT 1 INTO v_exists FROM Ordre WHERE Num_Ordre = p_NumOrdre LIMIT 1;IF v_exists IS NULL THEN SET v_datetime = DATE_ADD(v_pivot, INTERVAL p_NumOrdre SECOND);INSERT IGNORE INTO Ordre (Num_Ordre,JJ,MM,AAAA,HH,MN,SS) VALUES (p_NumOrdre,DAY(v_datetime),MONTH(v_datetime),YEAR(v_datetime),HOUR(v_datetime),MINUTE(v_datetime),SECOND(v_datetime));END IF;END IF;END$$

DELIMITER;


/* =========================================================
CREATE TRIGGER FUNCTIO HANDLE ORDRE
========================================================= */
DELIMITER $$

CREATE TRIGGER trg_User_bi_Num_Ordre_Sign_In BEFORE INSERT ON UTILISATEUR FOR EACH ROW BEGIN IF NEW.Num_Ordre_Sign_In IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Sign_In); END IF; END$$
CREATE TRIGGER trg_User_bu_Num_Ordre_Sign_In BEFORE UPDATE ON UTILISATEUR FOR EACH ROW BEGIN IF NEW.Num_Ordre_Sign_In IS NOT NULL AND NEW.Num_Ordre_Sign_In <> OLD.Num_Ordre_Sign_In THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Sign_In); END IF; END$$
CREATE TRIGGER trg_Email_bi_Num_Ordre_Envoi BEFORE INSERT ON Email FOR EACH ROW BEGIN IF NEW.Num_Ordre_Envoi IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Envoi); END IF; END$$
CREATE TRIGGER trg_Email_bu_Num_Ordre_Envoi BEFORE UPDATE ON Email FOR EACH ROW BEGIN IF NEW.Num_Ordre_Envoi IS NOT NULL AND NEW.Num_Ordre_Envoi <> OLD.Num_Ordre_Envoi THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Envoi); END IF; END$$
CREATE TRIGGER trg_Post_bi_Num_Ordre_Post BEFORE INSERT ON Post FOR EACH ROW BEGIN IF NEW.Num_Ordre_Post IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Post); END IF; END$$
CREATE TRIGGER trg_Post_bu_Num_Ordre_Post BEFORE UPDATE ON Post FOR EACH ROW BEGIN IF NEW.Num_Ordre_Post IS NOT NULL AND NEW.Num_Ordre_Post <> OLD.Num_Ordre_Post THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Post); END IF; END$$
CREATE TRIGGER trg_Commentaire_bi_Num_Ordre_Commentaire BEFORE INSERT ON Commentaire FOR EACH ROW BEGIN IF NEW.Num_Ordre_Commentaire IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Commentaire); END IF; END$$
CREATE TRIGGER trg_Commentaire_bu_Num_Ordre_Commentaire BEFORE UPDATE ON Commentaire FOR EACH ROW BEGIN IF NEW.Num_Ordre_Commentaire IS NOT NULL AND NEW.Num_Ordre_Commentaire <> OLD.Num_Ordre_Commentaire THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Commentaire); END IF; END$$
CREATE TRIGGER trg_Reaction_bi_Num_Ordre_Reaction BEFORE INSERT ON Reaction FOR EACH ROW BEGIN IF NEW.Num_Ordre_Reaction IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Reaction); END IF; END$$
CREATE TRIGGER trg_Reaction_bu_Num_Ordre_Reaction BEFORE UPDATE ON Reaction FOR EACH ROW BEGIN IF NEW.Num_Ordre_Reaction IS NOT NULL AND NEW.Num_Ordre_Reaction <> OLD.Num_Ordre_Reaction THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Reaction); END IF; END$$
CREATE TRIGGER trg_Action_User_bi_Num_Ordre BEFORE INSERT ON Action_utilisateur FOR EACH ROW BEGIN IF NEW.Num_Ordre IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre); END IF; END$$
CREATE TRIGGER trg_Action_User_bu_Num_Ordre BEFORE UPDATE ON Action_utilisateur FOR EACH ROW BEGIN IF NEW.Num_Ordre IS NOT NULL AND NEW.Num_Ordre <> OLD.Num_Ordre THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre); END IF; END$$
CREATE TRIGGER trg_Demande_Conge_bi_Num_Ordre BEFORE INSERT ON Demande_Conge FOR EACH ROW BEGIN IF NEW.Num_Ordre_Debut_Conge IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Debut_Conge); END IF; IF NEW.Num_Ordre_Fin_Conge IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Fin_Conge); END IF; END$$
CREATE TRIGGER trg_Demande_Conge_bu_Num_Ordre BEFORE UPDATE ON Demande_Conge FOR EACH ROW BEGIN IF NEW.Num_Ordre_Debut_Conge <> OLD.Num_Ordre_Debut_Conge THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Debut_Conge); END IF; IF NEW.Num_Ordre_Fin_Conge <> OLD.Num_Ordre_Fin_Conge THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Fin_Conge); END IF; END$$
CREATE TRIGGER trg_Offre_bi_Num_Ordre BEFORE INSERT ON Offre FOR EACH ROW BEGIN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Creation); CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Expiration); END$$
CREATE TRIGGER trg_Offre_bu_Num_Ordre BEFORE UPDATE ON Offre FOR EACH ROW BEGIN IF NEW.Num_Ordre_Creation <> OLD.Num_Ordre_Creation THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Creation); END IF; IF NEW.Num_Ordre_Expiration <> OLD.Num_Ordre_Expiration THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Expiration); END IF; END$$
CREATE TRIGGER trg_Entretien_bi_Num_Ordre_Entretien BEFORE INSERT ON Entretien FOR EACH ROW BEGIN IF NEW.Num_Ordre_Entretien IS NOT NULL THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Entretien); END IF; END$$
CREATE TRIGGER trg_Entretien_bu_Num_Ordre_Entretien BEFORE UPDATE ON Entretien FOR EACH ROW BEGIN IF NEW.Num_Ordre_Entretien IS NOT NULL AND NEW.Num_Ordre_Entretien <> OLD.Num_Ordre_Entretien THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Entretien); END IF; END$$
CREATE TRIGGER trg_Formation_bi_Num_Ordre_Creation BEFORE INSERT ON Formation FOR EACH ROW BEGIN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Creation); END$$
CREATE TRIGGER trg_Formation_bu_Num_Ordre_Creation BEFORE UPDATE ON Formation FOR EACH ROW BEGIN IF NEW.Num_Ordre_Creation <> OLD.Num_Ordre_Creation THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Creation); END IF; END$$
CREATE TRIGGER trg_Participation_Formation_bi_Num_Ordre BEFORE INSERT ON Participation_Formation FOR EACH ROW BEGIN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Participation); END$$
CREATE TRIGGER trg_Participation_Formation_bu_Num_Ordre BEFORE UPDATE ON Participation_Formation FOR EACH ROW BEGIN IF NEW.Num_Ordre_Participation <> OLD.Num_Ordre_Participation THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Participation); END IF; END$$
CREATE TRIGGER trg_Evenement_bi_Num_Ordre BEFORE INSERT ON Evenement FOR EACH ROW BEGIN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Creation); CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Debut_Evenement); CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Fin_Evenement); END$$
CREATE TRIGGER trg_Evenement_bu_Num_Ordre BEFORE UPDATE ON Evenement FOR EACH ROW BEGIN IF NEW.Num_Ordre_Creation <> OLD.Num_Ordre_Creation THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Creation); END IF; IF NEW.Num_Ordre_Debut_Evenement <> OLD.Num_Ordre_Debut_Evenement THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Debut_Evenement); END IF; IF NEW.Num_Ordre_Fin_Evenement <> OLD.Num_Ordre_Fin_Evenement THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Fin_Evenement); END IF; END$$
CREATE TRIGGER trg_Detail_Evenement_bi_Num_Ordre BEFORE INSERT ON Detail_Evenement FOR EACH ROW BEGIN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Debut_Activite); CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Fin_Activite); END$$
CREATE TRIGGER trg_Detail_Evenement_bu_Num_Ordre BEFORE UPDATE ON Detail_Evenement FOR EACH ROW BEGIN IF NEW.Num_Ordre_Debut_Activite <> OLD.Num_Ordre_Debut_Activite THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Debut_Activite); END IF; IF NEW.Num_Ordre_Fin_Activite <> OLD.Num_Ordre_Fin_Activite THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Fin_Activite); END IF; END$$
CREATE TRIGGER trg_Participation_Evenement_bi_Num_Ordre BEFORE INSERT ON Participation_Evenement FOR EACH ROW BEGIN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Participation); END$$
CREATE TRIGGER trg_Participation_Evenement_bu_Num_Ordre BEFORE UPDATE ON Participation_Evenement FOR EACH ROW BEGIN IF NEW.Num_Ordre_Participation <> OLD.Num_Ordre_Participation THEN CALL Ensure_NumOrdre_Exists(NEW.Num_Ordre_Participation); END IF; END$$

DELIMITER ;
